generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum PipelineStage {
  DATA_FIRST
  PROSPECT
  LEAD
  CLIENT
  CUSTOMER
}

enum ProjectStatus {
  NOT_STARTED
  IN_PROGRESS
  ON_HOLD
  COMPLETED
  CANCELLED
}

enum TaskStatus {
  TODO
  IN_PROGRESS
  IN_REVIEW
  DONE
}

enum InvoiceType {
  INBOUND
  OUTBOUND
}

enum AssetStatus {
  AVAILABLE
  ASSIGNED
  REPAIR
  SCRAPPED
}

model User {
  id            String   @id @default(cuid())
  name          String
  email         String   @unique
  phone         String?
  passwordHash  String
  department    String?
  designation   String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  employee      Employee?
  roleId        String?
  role          Role?    @relation(fields: [roleId], references: [id])
}

model Employee {
  id              String   @id @default(cuid())
  userId           String   @unique
  employeeCode     String   @unique
  dateOfJoining    DateTime
  ctc              Float?
  monthlySalary    Float?
  pan              String?
  bankAccount      String?
  ifsc             String?
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  user             User     @relation(fields: [userId], references: [id])
}

model Role {
  id          String       @id @default(cuid())
  name        String       @unique
  description String?
  users       User[]
  permissions Permission[]
}

model Permission {
  id         String @id @default(cuid())
  module     String
  action     String
  level      String
  roleId     String
  role       Role   @relation(fields: [roleId], references: [id], onDelete: Cascade)
}

model Contact {
  id             String        @id @default(cuid())
  name           String
  company        String?
  email          String?
  phone          String?
  source         String?
  notes          String?
  importDate     DateTime      @default(now())
  stage          PipelineStage @default(DATA_FIRST)
  leadScore      Int?
  budget         Float?
  timeline       String?
  decisionMaker  String?
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  projects       Project[]
}

model Project {
  id             String        @id @default(cuid())
  name           String
  description    String?
  clientId       String?
  startDate      DateTime?
  endDate        DateTime?
  projectValue   Float?
  paymentTerms   String?
  currency       String        @default("INR")
  status         ProjectStatus @default(NOT_STARTED)
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  client         Contact?      @relation(fields: [clientId], references: [id])
  milestones     Milestone[]
  tasks          DevTask[]
}

model Milestone {
  id             String     @id @default(cuid())
  projectId       String
  name            String
  description     String?
  etaHours        Float?
  actualHours     Float?
  invoiceRequired Boolean    @default(false)
  status          TaskStatus @default(TODO)
  dueDate         DateTime?
  createdAt       DateTime   @default(now())
  project         Project    @relation(fields: [projectId], references: [id], onDelete: Cascade)
}

model DevTask {
  id             String     @id @default(cuid())
  projectId      String
  title          String
  description    String?
  priority       String     @default("MEDIUM")
  status         TaskStatus @default(TODO)
  estimatedHours Float?
  actualHours    Float?
  startDate      DateTime?
  dueDate        DateTime?
  tags           String[]
  createdAt      DateTime   @default(now())
  updatedAt      DateTime   @updatedAt
  project        Project    @relation(fields: [projectId], references: [id], onDelete: Cascade)
}

model Invoice {
  id           String      @id @default(cuid())
  type         InvoiceType
  invoiceNo    String      @unique
  clientName   String
  projectId    String?
  invoiceDate  DateTime
  dueDate      DateTime
  totalAmount  Float
  paidAmount   Float       @default(0)
  status       String      @default("PENDING")
  createdAt    DateTime    @default(now())
}

model Expense {
  id            String   @id @default(cuid())
  date          DateTime
  category      String
  description   String?
  amount        Float
  paymentMethod String?
  billable      Boolean  @default(false)
  createdAt     DateTime @default(now())
}

model Candidate {
  id             String   @id @default(cuid())
  name           String
  email          String
  phone          String?
  currentCompany String?
  experienceYrs  Float?
  stage          String
  expectedCtc    Float?
  createdAt      DateTime @default(now())
}

model LeaveRequest {
  id         String   @id @default(cuid())
  employeeId String
  type       String
  reason     String
  fromDate   DateTime
  toDate     DateTime
  status     String   @default("PENDING")
  createdAt  DateTime @default(now())
}

model Asset {
  id           String      @id @default(cuid())
  assetId      String      @unique
  name         String
  category     String
  brand        String?
  model        String?
  serialNumber String?
  purchaseDate DateTime?
  purchaseCost Float?
  status       AssetStatus @default(AVAILABLE)
  location     String?
  createdAt    DateTime    @default(now())
}

model Credential {
  id            String   @id @default(cuid())
  toolName       String
  loginUrl       String?
  username       String?
  encryptedValue String
  expiryDate     DateTime?
  accessLevel    Int      @default(1)
  createdAt      DateTime @default(now())
}
